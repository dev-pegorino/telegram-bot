# Base Telegram Bot in aiogram 3.x

–ë–∞–∑–æ–≤—ã–π Telegram –±–æ—Ç, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ aiogram 3.x —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π SQLAlchemy, Alembic –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç—ã —Å SQLite/MySQL –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö. –ü—Ä–æ–µ–∫—Ç –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è –≥–æ—Ç–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ Telegram –±–æ—Ç–æ–≤ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏.

[üá∫üá∏ English version](README.md)

## –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è Telegram –±–æ—Ç–æ–≤ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:
- **aiogram 3.x** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Telegram Bot API
- **SQLAlchemy 2.x** - ORM –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö
- **Alembic** - —Å–∏—Å—Ç–µ–º–∞ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **Pydantic Settings** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
- **Ruff** - –±—ã—Å—Ç—Ä—ã–π –ª–∏–Ω—Ç–µ—Ä –∏ —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –∫–æ–¥–∞
- **UV** - —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤ Python

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
telegram-bot/
‚îú‚îÄ‚îÄ src/                          # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/                 # –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ base.py               # –ë–∞–∑–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–î
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py             # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot.db                # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modules/              # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –º–æ–¥–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py           # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ requests/             # –ó–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ __init__.py       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ user.py           # –ó–∞–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ handlers/                 # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ commands.py           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îú‚îÄ‚îÄ callbacks/                # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback-–∑–∞–ø—Ä–æ—Å–æ–≤
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è callback
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ common.py             # –û–±—â–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ keyboards/            # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥—É–ª—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ builders.py       # –ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ logger.py             # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migration_database.py # –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ command_runner.py     # –£—Ç–∏–ª–∏—Ç–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings_bot.py       # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ init_bot.py               # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ run.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ .example.env              # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ alembic/                      # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ versions/                 # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ env.py                    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è Alembic
‚îÇ   ‚îî‚îÄ‚îÄ script.py.mako            # –®–∞–±–ª–æ–Ω –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ logs/                         # –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ pyproject.toml                # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ uv.lock                       # –§–∞–π–ª –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ alembic.ini                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îú‚îÄ‚îÄ ruff.toml                     # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ª–∏–Ω—Ç–µ—Ä–∞ Ruff
‚îú‚îÄ‚îÄ .python-version               # –í–µ—Ä—Å–∏—è Python
‚îî‚îÄ‚îÄ .gitignore                    # –ò—Å–∫–ª—é—á–µ–Ω–∏—è –¥–ª—è Git
```

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

- **`src/run.py`** - –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞
- **`src/config.py`** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- **`src/init_bot.py`** - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞ –∏ –¥–∏—Å–ø–µ—Ç—á–µ—Ä–∞
- **`src/database/`** - –í—Å–µ —Ñ–∞–π–ª—ã, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **`src/utils/migration_database.py`** - –£—Ç–∏–ª–∏—Ç–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π
- **`pyproject.toml`** - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞, –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ —Å–∫—Ä–∏–ø—Ç—ã
- **`alembic.ini`** - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã –º–∏–≥—Ä–∞—Ü–∏–π

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ UV

#### Windows
```powershell
# –ß–µ—Ä–µ–∑ PowerShell
irm https://astral.sh/uv/install.ps1 | iex

# –ò–ª–∏ —á–µ—Ä–µ–∑ pip
pip install uv
```

#### Unix —Å–∏—Å—Ç–µ–º—ã (Linux/macOS)
```bash
# –ß–µ—Ä–µ–∑ curl
curl -LsSf https://astral.sh/uv/install.sh | sh

# –ò–ª–∏ —á–µ—Ä–µ–∑ pip
pip install uv
```

### 2. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞

```bash
cd telegram-bot
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª —Å –ø—Ä–∏–º–µ—Ä–æ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:
```bash
cp src/.example.env src/.env
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/.env` –∏ –¥–æ–±–∞–≤—å—Ç–µ:
```env
TOKEN_BOT=your_telegram_bot_token_here
DB_URL=sqlite+aiosqlite:///src/database/bot.db
```

**–í–∞—Ä–∏–∞–Ω—Ç—ã DB_URL:**
- SQLite: `sqlite+aiosqlite:///src/database/bot.db`
- MySQL: `mysql+aiomysql://username:password@localhost:3306/database_name`

### 4. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
uv run start
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°–æ–∑–¥–∞—Å—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ó–∞–ø—É—Å—Ç–∏—Ç –±–æ—Ç–∞

## –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Alembic

–°–Ω–∞—á–∞–ª–∞ —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Alembic:
```bash
cp example.alembic.ini alembic.ini
```

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `alembic.ini` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—à–∏–º —Ñ–∞–π–ª–æ–º `.env`:
```ini
sqlalchemy.url = your_database_url_here
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏

```bash
uv run migrate name "–æ–ø–∏—Å–∞–Ω–∏–µ_–º–∏–≥—Ä–∞—Ü–∏–∏"
```

–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞:
1. –°–æ–∑–¥–∞—Å—Ç –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º
2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏—Ç –µ—ë –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã
uv run migrate name "add_users_table"

# –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
uv run migrate name "update_user_fields"
```

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Ruff –¥–ª—è –ª–∏–Ω—Ç–∏–Ω–≥–∞ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞
uv run ruff check

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –≤ –∫–æ–¥–µ
uv run ruff --fix
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

1. **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ `src/handlers/`
2. **Callback –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ `src/callbacks/`
3. **–ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ `src/database/models.py`
4. **–ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã** - –¥–æ–±–∞–≤–ª—è–π—Ç–µ –≤ `src/utils/keyboards/`

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.13+
- UV (–º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤)
- Telegram Bot Token
- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (SQLite –∏–ª–∏ MySQL)

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
